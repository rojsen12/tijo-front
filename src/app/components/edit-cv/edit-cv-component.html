<div class="navbar-container">
  <app-navbar></app-navbar>
</div>

<div class="edit-cv-wrapper">
  <div class="sidebar">
    <div class="sidebar-header">
      <h3>Sekcje CV</h3>
      <div class="template-badge">{{ selectedTemplate }}</div>
    </div>

    <nav class="sections-nav">
      <button
        *ngFor="let section of sections"
        [class.active]="activeSection === section.id"
        (click)="setActiveSection(section.id)"
        class="section-btn">
        <i class="pi" [ngClass]="section.icon"></i>
        <span>{{ section.name }}</span>
      </button>
    </nav>
  </div>

  <div class="main-content">
    <div class="content-header">
      <h1>{{ isEditMode ? 'Edytuj CV' : 'Utwórz CV' }}</h1>
    </div>

    <form [formGroup]="cvForm" (ngSubmit)="onSubmit()">

      <div class="form-section" *ngIf="activeSection === 'personal'">
        <div class="section-title">
          <i class="pi pi-user"></i>
          <h2>Dane osobowe</h2>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Imię <span class="required">*</span></label>
            <input type="text" formControlName="firstName" class="form-input" placeholder="Jan">
            <small class="error-msg" *ngIf="cvForm.get('firstName')?.invalid && cvForm.get('firstName')?.touched">
              Pole wymagane
            </small>
          </div>

          <div class="form-group">
            <label>Nazwisko <span class="required">*</span></label>
            <input type="text" formControlName="lastName" class="form-input" placeholder="Kowalski">
            <small class="error-msg" *ngIf="cvForm.get('lastName')?.invalid && cvForm.get('lastName')?.touched">
              Pole wymagane
            </small>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Email <span class="required">*</span></label>
            <input type="email" formControlName="email" class="form-input" placeholder="jan.kowalski@email.com">
            <small class="error-msg" *ngIf="cvForm.get('email')?.invalid && cvForm.get('email')?.touched">
              Podaj poprawny adres email
            </small>
          </div>

          <div class="form-group">
            <label>Telefon <span class="required">*</span></label>
            <input type="tel" formControlName="phone" class="form-input" placeholder="+48 123 456 789">
            <small class="error-msg" *ngIf="cvForm.get('phone')?.invalid && cvForm.get('phone')?.touched">
              Pole wymagane
            </small>
          </div>
        </div>

        <div class="form-group">
          <label>Adres</label>
          <input type="text" formControlName="address" class="form-input" placeholder="Warszawa, Polska">
        </div>

        <div class="form-group">
          <label>Zdjęcie profilowe (URL)</label>
          <input type="text" formControlName="profilePicture" class="form-input" placeholder="https://...">
        </div>

        <div class="form-group">
          <label>O mnie</label>
          <textarea formControlName="summary" class="form-textarea" rows="5" placeholder="Opisz siebie..."></textarea>
        </div>
      </div>

      <div class="form-section" *ngIf="activeSection === 'experience'">
        <div class="section-title">
          <i class="pi pi-briefcase"></i>
          <h2>Doświadczenie zawodowe</h2>
          <button type="button" class="add-btn" (click)="addExperience()">
            <i class="pi pi-plus"></i> Dodaj
          </button>
        </div>

        <div formArrayName="experiences">
          <div *ngFor="let exp of experiences.controls; let i = index" class="dynamic-card">
            <div [formGroupName]="i">
              <div class="card-header">
                <span class="card-number">{{ i + 1 }}</span>
                <button type="button" class="remove-btn" (click)="removeExperience(i)">
                  <i class="pi pi-trash"></i>
                </button>
              </div>

              <div class="form-grid">
                <div class="form-group">
                  <label>Stanowisko <span class="required">*</span></label>
                  <input type="text" formControlName="position" class="form-input" placeholder="Frontend Developer">
                </div>

                <div class="form-group">
                  <label>Firma <span class="required">*</span></label>
                  <input type="text" formControlName="company" class="form-input" placeholder="Tech Company">
                </div>
              </div>

              <div class="form-grid grid-3">
                <div class="form-group">
                  <label>Lokalizacja</label>
                  <input type="text" formControlName="location" class="form-input" placeholder="Warszawa">
                </div>

                <div class="form-group">
                  <label>Od <span class="required">*</span></label>
                  <input type="date" formControlName="startDate" class="form-input">
                </div>

                <div class="form-group">
                  <label>Do</label>
                  <input type="date" formControlName="endDate" class="form-input">
                </div>
              </div>

              <div class="form-group">
                <label>Opis</label>
                <textarea formControlName="description" class="form-textarea" rows="3" placeholder="Opisz swoje obowiązki..."></textarea>
              </div>
            </div>
          </div>

          <div *ngIf="experiences.length === 0" class="empty-state">
            <i class="pi pi-briefcase empty-icon"></i>
            <p>Brak dodanych doświadczeń</p>
            <button type="button" class="primary-btn" (click)="addExperience()">
              Dodaj pierwsze doświadczenie
            </button>
          </div>
        </div>
      </div>

      <div class="form-section" *ngIf="activeSection === 'education'">
        <div class="section-title">
          <i class="pi pi-book"></i>
          <h2>Edukacja</h2>
          <button type="button" class="add-btn" (click)="addEducation()">
            <i class="pi pi-plus"></i> Dodaj
          </button>
        </div>

        <div formArrayName="educations">
          <div *ngFor="let edu of educations.controls; let i = index" class="dynamic-card">
            <div [formGroupName]="i">
              <div class="card-header">
                <span class="card-number">{{ i + 1 }}</span>
                <button type="button" class="remove-btn" (click)="removeEducation(i)">
                  <i class="pi pi-trash"></i>
                </button>
              </div>

              <div class="form-grid">
                <div class="form-group">
                  <label>Kierunek/Tytuł <span class="required">*</span></label>
                  <input type="text" formControlName="degree" class="form-input" placeholder="Informatyka">
                </div>

                <div class="form-group">
                  <label>Uczelnia <span class="required">*</span></label>
                  <input type="text" formControlName="institution" class="form-input" placeholder="Politechnika Warszawska">
                </div>
              </div>

              <div class="form-grid grid-3">
                <div class="form-group">
                  <label>Lokalizacja</label>
                  <input type="text" formControlName="location" class="form-input" placeholder="Warszawa">
                </div>

                <div class="form-group">
                  <label>Od <span class="required">*</span></label>
                  <input type="date" formControlName="startDate" class="form-input">
                </div>

                <div class="form-group">
                  <label>Do</label>
                  <input type="date" formControlName="endDate" class="form-input">
                </div>
              </div>

              <div class="form-group">
                <label>Opis</label>
                <textarea formControlName="description" class="form-textarea" rows="3" placeholder="Dodatkowe informacje..."></textarea>
              </div>
            </div>
          </div>

          <div *ngIf="educations.length === 0" class="empty-state">
            <i class="pi pi-book empty-icon"></i>
            <p>Brak dodanej edukacji</p>
            <button type="button" class="primary-btn" (click)="addEducation()">
              Dodaj pierwszą edukację
            </button>
          </div>
        </div>
      </div>

      <div class="form-section" *ngIf="activeSection === 'skills'">
        <div class="section-title">
          <i class="pi pi-cog"></i>
          <h2>Umiejętności</h2>
          <button type="button" class="add-btn" (click)="addSkill()">
            <i class="pi pi-plus"></i> Dodaj
          </button>
        </div>

        <div formArrayName="skills" class="skills-container">
          <div *ngFor="let skill of skills.controls; let i = index" class="skill-chip">
            <div [formGroupName]="i">
              <input type="text" formControlName="name" class="skill-input" placeholder="np. JavaScript">
              <button type="button" class="chip-remove" (click)="removeSkill(i)">
                <i class="pi pi-times"></i>
              </button>
            </div>
          </div>

          <div *ngIf="skills.length === 0" class="empty-state">
            <i class="pi pi-cog empty-icon"></i>
            <p>Brak dodanych umiejętności</p>
            <button type="button" class="primary-btn" (click)="addSkill()">
              Dodaj pierwszą umiejętność
            </button>
          </div>
        </div>
      </div>

      <div class="form-section" *ngIf="activeSection === 'languages'">
        <div class="section-title">
          <i class="pi pi-globe"></i>
          <h2>Języki</h2>
          <button type="button" class="add-btn" (click)="addLanguage()">
            <i class="pi pi-plus"></i> Dodaj
          </button>
        </div>

        <div formArrayName="languages">
          <div *ngFor="let lang of languages.controls; let i = index" class="dynamic-card compact">
            <div [formGroupName]="i">
              <div class="form-grid grid-3">
                <div class="form-group">
                  <label>Język <span class="required">*</span></label>
                  <input type="text" formControlName="name" class="form-input" placeholder="Angielski">
                </div>

                <div class="form-group">
                  <label>Poziom <span class="required">*</span></label>
                  <select formControlName="level" class="form-input">
                    <option *ngFor="let level of languageLevels" [value]="level">
                      {{ level }}
                    </option>
                  </select>
                </div>

                <div class="form-group flex-end">
                  <button type="button" class="remove-btn" (click)="removeLanguage(i)">
                    <i class="pi pi-trash"></i> Usuń
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="languages.length === 0" class="empty-state">
            <i class="pi pi-globe empty-icon"></i>
            <p>Brak dodanych języków</p>
            <button type="button" class="primary-btn" (click)="addLanguage()">
              Dodaj pierwszy język
            </button>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="secondary-btn" (click)="cancel()">
          <i class="pi pi-times"></i> Anuluj
        </button>
        <button type="submit" class="primary-btn" [disabled]="cvForm.invalid">
          <i class="pi pi-check"></i> {{ isEditMode ? 'Zapisz zmiany' : 'Utwórz CV' }}
        </button>
      </div>
    </form>
  </div>
</div>
